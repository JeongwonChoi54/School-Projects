---
title: "Assignment03"
author: "A0219728U"
output: html_document
---

The data-set used is the 'Cocktails' data-set from 2020.\
https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-26/cocktails.csv \
https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-26/boston_cocktails.csv \
As format of some of the data from 'boston_cocktails.csv' were different from the general format of the other data, such as rather than putting each ingredient in separate rows, those with same measurement being put into a single row or the unit of the measurement in different formats, preprocessing of data cleaning had been done before being used for plotting. For those rows were multiple ingredients have been placed in the same row, the rows were separated so that each row would represent only one ingredient and in case of units not in oz, the units were converted into oz; '1 750-ml' to '25.4 oz', '2 750-ml' to '50.8 oz', 'splash' to '0.5 oz', '1' for egg to '0.75 oz', 'Juice of Lemon or Lime' to '1.5 oz', '2 bottles' to '50 oz'.
After doing so, extra column, abv, alcohol by volume (%), has been added to the dataset where each of the ingredient's abv has been added as follows.

* 5%: Beer, Cider, Strout
* 10%: Aperol
* 12%: Port, Sherry, Wine, Champagne
* 15%: Cynar, Claret, Punt e Mes
* 20%: Vermouth, Schnapps, Curacao, Triple Sec, Creme types, Amaretto, Liqueuer types, Dubonnet (Rouge), Lillet (Blanc/Rouge), Sake, Amaro, Madeira, Campari, Swedish Punch
* 25%: Anisette, Cherry Heering
* 30%: Maraschino, Limoncello
* 40%: Rum/Whiskey/Brandy/Gin/Vodka/Cognac/Tequila types, Bitters, Benedictine, Kummel, Fernet-Branca, Grand Marnier, Pimm's No. 1 Cup, Kirschwasser, B & B, Strega, Aquavit, Calvados, Pisco, Sambuca, Forbidden Fruit, Becherovka, Drambuie
* 45%: Applejack, Absinthe, Galliano, Cachaca
* 50%: 100 proof vodka
* 55%: Chartreuse, Mezcal, Armagnac
* 75.5%: 151-Proof Rum

```{r, echo=FALSE, warning=FALSE, message=FALSE, results=FALSE}
library(tidyverse)
library(stringr)

boston_cocktails <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-26/boston_cocktails.csv')

cocktails <- boston_cocktails%>%
  select(name, ingredient, measure) %>%
  group_by(name)

# Check which ingredients are put together e.g, 'each Dark rum, light rum'
each <- cocktails %>%
  filter(grepl("^each", ingredient))

# Remove rows where ingredients have 'each' and needs to be separated
cocktails <- cocktails %>%
  filter(!grepl("^each", ingredient))

# Separate all the ingredients
jungle_juice <- data.frame(c("Jungle Juice"), 
                           c("Cranberry Juice", "Orange Juice", "Pineapple Juice", "Lemon Juice"),
                           c("1 oz"))
colnames(jungle_juice) <- c("name", "ingredient", "measure")

jackie_o <- data.frame(c("Jackie-O"),
                       c("Citrus-flavored vodka", "Orange-flavored vodka", "Lemon Juice", "Cranberry Juice"),
                       c("1/2 oz"))
colnames(jackie_o) <- c("name", "ingredient", "measure")

tahitian <- data.frame(c("Tahitian Tea"),
                       c("Cranberry Juice", "Orange Juice"),
                       c("1 oz"))
colnames(tahitian) <- c("name", "ingredient", "measure")

zombie <- data.frame(c("Zombie"), 
                     c("Lime Juice", "Lemon Juice", "Pineapple Juice", "Passion fruit syrup"),
                     c("1 oz"))
colnames(zombie) <- c("name", "ingredient", "measure")

wiki <- data.frame(c("Wiki Waki Woo"),
                   c("Vodka", "Tequila blanco", "Triple sec"),
                   c("1/2 oz"))
colnames(wiki) <- c("name", "ingredient", "measure")

wiki2 <- data.frame(c("Wiki Waki Woo"),
                    c("Orange Juice", "Pineapple Juice", "Cranberry Juice"),
                    c("1 oz"))
colnames(wiki2) <- c("name", "ingredient", "measure")

vacation <- data.frame(c("The Vacation Cocktail"),
                       c("Simple Syrup", "Light Rum", "Dark Rum", "Cranberry Juice", "Orange Juice", "Spiced Rum"),
                       c("1/2 oz"))
colnames(vacation) <- c("name", "ingredient", "measure")

puerto <- data.frame(c("Puerto Rican Rum Daisy"),
                     c("Orange Juice", "Simple Syrup"),
                     c("1/2 oz"))
colnames(puerto) <- c("name", "ingredient", "measure")

planter <- data.frame(c("Planter's Punch No. 2"),
                      c("Lime Juice", "Jamaica Rum", "Grenadine"),
                      c("1 oz", "1 oz", "1 dash"))
colnames(planter) <- c("name", "ingredient", "measure")

planter2 <- data.frame(c("Planter's Punch No. 2"),
                       c("Lemon Juice", "Triple Sec"),
                       c("1/4 oz"))
colnames(planter2) <- c("name", "ingredient", "measure")

caesar <- data.frame(c("Caesar"),
                     c("Worcestershire Sauce", "salt", "ground black pepper"),
                     c("1 oz", "1 pinch", "1 pinch"))
colnames(caesar) <- c("name", "ingredient", "measure")

basil <- data.frame(c("Basil 8"),
                    c("Simple Syrup", "Angostura Bitters"),
                    c("1 oz", "1 dash"))
colnames(basil) <- c("name", "ingredient", "measure")

purple <- data.frame(c("Purple Pancho"),
                     c("Lemon Juice", "Simple Syrup"),
                     c("1 oz"))
colnames(purple) <- c("name", "ingredient", "measure")

lumination <- data.frame(c("Lumination"),
                         c("Lemon Juice", "Angostura Bitters"),
                         c("1 oz", "1 oz"))
colnames(lumination) <- c("name", "ingredient", "measure")

hurricane_leah <- data.frame(c("Hurricane Leah"),
                             c("Light Rum", "Gin", "Vodka", "Blanco Tequila", "Blue Curacao"),
                             c("1/4 oz"))
colnames(hurricane_leah) <- c("name", "ingredient", "measure")

hurricane <- data.frame(c("Hurricane"),
                        c("Dark Rum", "Light Rum"),
                        c("1 1/2 oz"))
colnames(hurricane) <- c("name", "ingredient", "measure")

fog <- data.frame(c("Fog Cutter"),
                  c("Orange Juice", "Sherry"),
                  c("1 oz"))
colnames(fog) <- c("name", "ingredient", "measure")

lily <- data.frame(c("Lillypad"),
                   c("Lillet Blanc", "Lillet Rouge"),
                   c("1/2 oz"))
colnames(lily) <- c("name", "ingredient", "measure")

cactus <- data.frame(c("Cactus Berry"),
                     c("Triple Sec", "Simple Syrup"),
                     c("1/2 oz"))
colnames(cactus) <- c("name", "ingredient", "measure")

cactus2 <- data.frame(c("Cactus Berry"),
                      c("Lemon Juice", "Lime Juice"),
                      c("1/4 oz"))
colnames(cactus2) <- c("name", "ingredient", "measure")

separate_each <- bind_rows(jungle_juice, jackie_o, tahitian, zombie, wiki, wiki2, vacation,
                           puerto, planter, planter2, caesar, basil, purple, lumination,
                           hurricane_leah, hurricane, fog, lily, cactus, cactus2)

# Add back the separated ingredients so that each row would only have single liquid as ingredient
# ingredients such as 'Orange twist, green olive' are kept as it is as it would not impact the volume of the beverage
cocktails <-rbind(cocktails, separate_each) %>% group_by(name)

# Check all the measure values that are in 'oz'
cocktails$measure[str_detect(cocktails$measure, "oz")] %>% unique()

# Converting string in fraction format to numeric value
measure_in_oz <- cocktails %>% 
  filter(grepl("oz", measure)) %>% 
  mutate(measure = substr(measure, 1, nchar(measure)-3)) %>%
  mutate(oz = ifelse(nchar(measure) <= 2, as.numeric(measure), 
                     ifelse(nchar(measure) == 3, 
                            (as.numeric(substr(measure, 1, 1))/as.numeric(substr(measure, 3, 3))),
                            (as.numeric(substr(measure, 1, 1)) + 
                       as.numeric(substr(measure, nchar(measure)-2, nchar(measure)-2))
                     /as.numeric(substr(measure, nchar(measure), nchar(measure)))))))

# Other ingredients not in "oz"
not_in_oz <- cocktails %>% 
  filter(!grepl("oz", measure)) %>%
  mutate(oz = ifelse(measure == "1 750-ml", 25.4, 0))

not_in_oz$oz[not_in_oz$measure == "2 750-ml"] <- 50.8
not_in_oz$oz[grepl("splash", not_in_oz$measure)] <- 0.5
not_in_oz$oz[grepl("Egg", not_in_oz$ingredient)] <- 0.75
not_in_oz$oz[not_in_oz$ingredient == "Juice of Lemon or Lime"] <- 1.5
not_in_oz$oz[not_in_oz$measure == "2 bottles"] <- 50

# Combine the two
cocktails <- rbind(measure_in_oz, not_in_oz)

# Check ingredients
ingredients <- cocktails$ingredient %>% unique()

no_alc <- ingredients[str_detect(ingredients, "[J|j]uice|[S|s]yrup|[W|w]ater|Egg|[M|m]ilk")]
cocktails_abv <- cocktails %>%
  mutate(abv = ifelse(ingredient %in% no_alc, 0, NA))

abv_40 <- ingredients[str_detect(ingredients, 
                                 "[R|r]um|[V|v]odka|[W|w]hiskey|[W|w]hisky|[G|g]in$|[B|b]ourbon|
                                  |[T|t]equila|[B|b]randy|[C|c]ognac|[B|b]itters|Scotch|Rye
                                  |Benedictine|Kummel|Fernet-Branca|Marnier|Forbidden|Pimm's|Kirschwasser|
                                  |B & B|Amer|Calvados|Strega|Aquavit|Pisco|Sambuca|Pastis|rhum|Becherovka|
                                  |Drambuie")]
abv_45 <- ingredients[str_detect(ingredients, "Absinthe|Applejack|Galliano|Cachaca")]
abv_55 <- ingredients[str_detect(ingredients, "Chartreuse|Mezcal|Armagnac")]

# As abv can differ depending on which brand one uses, unify abv as 40%
cocktails_abv$abv[cocktails_abv$ingredient %in% abv_40] <- 40
cocktails_abv$abv[cocktails_abv$ingredient %in% abv_45] <- 45
cocktails_abv$abv[cocktails_abv$ingredient %in% abv_55] <- 55

# Check other ingredients for liquor
abv_na <- cocktails_abv %>% filter(is.na(abv))
ingred_abv_na <- abv_na$ingredient %>% unique()

abv_10 <- ingred_abv_na[str_detect(ingred_abv_na, "Aperol")]
abv_15 <- ingred_abv_na[str_detect(ingred_abv_na, "Cynar|Mes|Claret")]
abv_20 <- ingred_abv_na[str_detect(ingred_abv_na, "[V|v]ermo|[C|c]ura|[L|l]iqueur|[C|c]reme|schnapps|
                                                   |Sake|[S|s]ec|Amaro|Amaretto|Rouge|Lillet|Madeira|
                                                   |Campari|Dubonnet|Punch")]
abv_25 <- ingred_abv_na[str_detect(ingred_abv_na, "Anisette|Pimm's|Heering")]
abv_30 <- ingred_abv_na[str_detect(ingred_abv_na, "Maraschino$|[L|l]imoncello")]

cocktails_abv$abv[cocktails_abv$ingredient %in% abv_10] <- 10
cocktails_abv$abv[cocktails_abv$ingredient %in% abv_15] <- 15
cocktails_abv$abv[cocktails_abv$ingredient %in% abv_20] <- 20
cocktails_abv$abv[cocktails_abv$ingredient %in% abv_25] <- 25
cocktails_abv$abv[cocktails_abv$ingredient %in% abv_30] <- 30


# Check other ingredients with abv not yet updated
ingre <- cocktails_abv %>% filter(is.na(abv)) %>% ungroup() %>% select(ingredient) %>% unique()

abv_12 <- ingred_abv_na[str_detect(ingred_abv_na, "[W|w]ine|[S|s]herry|[P|p]ort|Champagne")]
cocktails_abv$abv[cocktails_abv$ingredient %in% abv_12] <- 12

# Beer, cider
abv_5 <- ingred_abv_na[str_detect(ingred_abv_na, "[B|b]eer|[C|c]ider|Stout")]
cocktails_abv$abv[cocktails_abv$ingredient %in% abv_5] <- 5

# Check other ingredients with abv not yet updated
abv_na <- cocktails_abv %>% filter(is.na(abv))
ingred_abv_na <- abv_na$ingredient %>% unique()
no_alc <- ingred_abv_na[str_detect(ingred_abv_na, "[C|c]ream|ale|[T|t]ea|[C|c]offee|[S|s]oda|Mix|Agave|
                                                   |[G|g]renadine|half-and-half|Cola|Sherbet|[S|s]auce|
                                                   |Yogurt|brine|Catsup|[V|v]inegar|puree|nectar|7-Up|
                                                   |Lemonade|Ket")]
cocktails_abv$abv[cocktails_abv$ingredient %in% no_alc] <- 0
cocktails_abv$abv[cocktails_abv$ingredient %in% c("100-proof Vodka", "Old Mr. Boston 100 proof Vodka")] <- 50
cocktails_abv$abv[cocktails_abv$ingredient == "151-Proof Rum"] <- 75.5

# Calculate alchol oz
cocktails_alcohol_abv <- cocktails_abv %>% filter(!is.na(abv)) %>%
  mutate(alchol_oz = oz * abv/100) %>%
  summarise(abv = sum(alchol_oz)/sum(oz)*100, total_oz = sum(oz))

boston_cocktails$category[boston_cocktails$category == "Rum - Daiquiris"] <- "Rum"

cocktail_abv_and_category <- cocktails_alcohol_abv %>% 
              left_join(boston_cocktails %>% 
              select(name, category), by = "name") %>% 
              unique() %>% ungroup()

cocktails <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-26/cocktails.csv')

cocktail_abv_and_category$category[cocktail_abv_and_category$category == "Whiskies"] <- "Whiskey"
cocktail_abv_and_category$category[cocktail_abv_and_category$category == "Cordials and Liqueurs"] <- "Others"
```

For the first graph, ABV (Alcohol by Volume) of Cocktails, it is targeted towards a layman interested in cocktails. Unlike other beverages, cocktails are made from mixing various liquors, making it hard to determine how strong the drink is or it's alcohol content. Not knowing the estimate amount of alcohol in the drink, there would have been cases where when trying out new cocktails, one couldn't finish it because it was too strong to handle or perhaps was too weak and did not feel like drinking alcohol at all. Repeated failure of cocktail picks may turn one to become reluctant in trying out other new cocktails. Hence, the following graph is to aid individuals in getting grasp of the rough abv of the cocktail drinks and make cocktail choices relatively easier,
where the abv has been calculated by 

1. determining abv of all the ingredients
2. calculate the alcohol oz of each ingredients: (abv x oz)/100 where abv is given as %
3. for each cocktail drink, find abv(%): (sum of alcohol oz of the ingredients)/(sum of oz of all the liquid ingredients) x 100
  
However, again, this would merely be a rough estimate as depending on the choice of liquors or the recipe, the abv would vary. Therefore, when creating the plot, I have plotted only the name of the cocktails and jittered the position with width 0.5 and height 0.3 as the main goal of this plot lies in only providing guideline of rough estimate of the alcohol content so plotting only the name of the cocktails would allow easier visualization of it's corresponding abv while allowing for minimum overlap between the plotted geoms. For the same reason, text geoms have been plotted using geom_text_repel with the line segment, connecting the point and the text, being transparent. Another thing to note is that as the number of cocktails given were too many to be plotted as names into a single graph, only the cocktails appearing in both the 'cocktails.csv' and 'boston_cocktails.csv' were plotted with the assumption that a cocktail appearing in both files would be more common at bars so that the below plot could actually come in handy in more general terms. From the names of cocktails both appearing in 'cocktails.csv' and 'boston_cocktails.csv', as 'Bloody Marry' was the only data with too large of the total volume of the drink, it has been removed to make the plot be more compact.
Along with it's abv, the total volume of the drink and the category in which it lies is also given. Yet, as they are provided only as a reference, the axis text of x is removed and the size and the title for legend is reduced.
```{r, echo=FALSE, message=FALSE, out.width="100%"}

library(ggrepel)
cocktails <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-26/cocktails.csv')

ggplot(cocktail_abv_and_category %>% 
         filter(total_oz < 8, name %in% cocktails$drink), 
       aes(x = total_oz, y = abv)) +
  geom_text_repel(aes(label = name, col = category), size = 1.6, 
                  position = position_jitter(width = 0.5, height = 0.3), max.overlaps = 25,
                  segment.color='transparent' ) +
  labs(title = "ABV (Alcohol by Volume) of Cocktails", x = "Volume of the Drink (oz)",
       y = "ABV (%)") +
  scale_color_discrete(name = "Category of the Drinks",
                       limits = c("Brandy", "Rum", "Gin", "Whiskey", "Tequila", "Vodka",
                                  "Cocktail Classics","Others")) +
  theme(axis.text.x = element_blank(),
        legend.title = element_text(size = 6),
        legend.text = element_text(size = 4.5),
        legend.key = element_blank(),
        legend.box.margin = margin(0,0,0,0))
```

The second graph is targeted towards more specific audience, those with basic understanding of statistics and has interest in cocktails as well. The second graph shows the distribution of boston cocktails' abv distribution by category. Again, the abv is a rough estimate and this graph merely shows overall distribution and brief summary of the cocktails by the categories. For easier recognition of the distribution, the transparency of the points is set to 0.2 with position of the points jittered by height 0.1 and width 0.5. Here, while the plots have been colour-coded by categories to make it more visually appealing, as the colours do not have much meaningful attribution to the plot with the y-axis already representing the categories, the legend has been removed.
Even so, as the plots are still being too clustered to make any meaningful insights at a glance, the stat_summary abv of each category is added in black for the corresponding category to show what the general distribution of abv of each category of drinks would be. From this, it can be seen that boston cocktails in whiskey category would have higher abv compared to those in vodka category in general.\
```{r, echo=FALSE, message=FALSE, warning=FALSE, out.width="70%"}
cocktail_abv_and_category %>%
  mutate(category = fct_reorder(category, abv, median)) %>%
  ggplot(aes(y = category, x = abv)) +
  geom_point(aes(col = category), alpha = 0.2, 
             position = position_jitter(height = 0.1, width = 0.5)) +
  stat_summary(fun.x = "median", size = 0.1) +
  labs(title = "Distribution of ABV by Categories",
       x = "Alcohol by Volume (%)", y = "Category of the Drink") +
  theme(legend.position = "none")
```

